<!--connect.wxml-->
<view class="container">
  <!-- é¡µé¢é¡¶éƒ¨å¯¼èˆªæ æ ‡é¢˜ -->
  <view class="nav-bar">
    <view class="nav-title">å¥½å‹åˆ—è¡¨</view>
  </view>

  <!-- ç”¨æˆ·èƒŒæ™¯å›¾ç‰‡ -->
  <view class="theme-background" wx:if="{{userCards[currentTrackIndex].avatarUrl}}" style="background-image: url({{userCards[currentTrackIndex].avatarUrl}});"></view>
  <!-- èƒŒæ™¯è™šåŒ–å±‚ -->
  <view class="background-blur"></view>
  
  <!-- èƒŒæ™¯æ˜Ÿæ˜Ÿ -->
  <block wx:for="{{stars}}" wx:key="id">
    <view 
      class="star" 
      style="left: {{item.x}}rpx; top: {{item.y}}rpx; width: {{item.size}}rpx; height: {{item.size}}rpx; opacity: {{item.opacity}};"
      data-id="{{item.id}}">
    </view>
  </block>
  
  <!-- è¿æ¥é¡µé¢å†…å®¹ -->
  <view class="content">
    <!-- ä¸»é¢˜åˆ—è¡¨ -->
    <scroll-view class="music-playlist" scroll-y="{{false}}" bindtouchstart="touchStart" bindtouchmove="touchMove" bindtouchend="touchEnd">
      <!-- åŠ è½½ä¸­æç¤º -->
      <view class="loading-container" wx:if="{{isLoading}}">
        <view class="loading-icon"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
      
      <!-- é”™è¯¯æç¤º -->
      <view class="error-container" wx:elif="{{loadError}}">
        <text class="error-text">{{loadError}}</text>
        <view class="retry-btn" bindtap="initUserCards">é‡æ–°åŠ è½½</view>
      </view>
      
      <!-- ç©ºçŠ¶æ€æç¤º -->
      <view class="empty-container" wx:elif="{{userCards.length === 0}}">
        <view class="empty-icon">ğŸ‘¥</view>
        <text class="empty-text">æš‚æ— ç”¨æˆ·æ•°æ®</text>
        <text class="empty-subtext">è¯·ç­‰å¾…å…¶ä»–ç”¨æˆ·å¡«å†™é—®å·</text>
      </view>
      
      <!-- ç”¨æˆ·åç‰‡åˆ—è¡¨ -->
      <view class="playlist-container" wx:else>
        <!-- é¡¶éƒ¨å¡«å…… -->
        <view class="list-padding"></view>
        <!-- å®ç°ç‰©ç†æ»šåŠ¨æ•ˆæœçš„è½¨é“ -->
        <view class="track-wheel" style="transform: translateY({{scrollOffset}}rpx)">
          <view class="track-item {{index === currentTrackIndex ? 'active' : ''}}" 
                wx:for="{{userCards}}" 
                wx:key="index"
                style="opacity: {{1 - 0.12 * Math.abs(index - currentTrackIndex)}};"
                data-index="{{index}}"
                bindtap="onUserCardTap">
            <!-- å¤§å‹ä¸“è¾‘å°é¢å¼å¤´åƒ -->
            <view class="album-cover-container">
              <view class="album-cover-placeholder" wx:if="{{!item.avatarUrl}}" style="background-color: {{item.color || '#6366f1'}}">
                <text>{{item.name ? item.name[0] : '?'}}</text>
              </view>
              <image class="album-cover" wx:if="{{item.avatarUrl}}" src="{{item.avatarUrl}}" mode="aspectFill"></image>
            </view>
            <view class="track-info">
              <view class="track-title">{{item.name || 'æœªçŸ¥ç”¨æˆ·'}}</view>
              <view class="track-artist">{{item.subtitle || item.theme || 'ç”¨æˆ·åç‰‡'}}</view>
              <!-- ç”¨æˆ·æ ‡ç­¾ä½œä¸ºç‰¹è‰² -->
              <view class="track-tags" wx:if="{{item.details && item.details.features && item.details.features.length > 0}}">
                <view class="tag" wx:for="{{item.details.features}}" wx:for-item="feature" wx:key="*this" wx:if="{{index < 2}}">
                  {{feature}}
                </view>
                <view class="tag-more" wx:if="{{item.details.features.length > 2}}">+{{item.details.features.length - 2}}</view>
              </view>
              <!-- æ˜¾ç¤ºæ ‡ç­¾æ•°é‡å’Œé˜ˆå€¼ -->
              <view class="user-stats">
                <text class="stats-text">{{item.totalTags}}ä¸ªæ ‡ç­¾ Â· é˜ˆå€¼{{item.threshold}}</text>
              </view>
            </view>
          </view>
        </view>
        <!-- åº•éƒ¨å¡«å…… -->
        <view class="list-padding"></view>
      </view>
    </scroll-view>
    <!-- ç”¨æˆ·è¯¦ç»†ä¿¡æ¯å¼¹çª— -->
    <view class="user-detail-modal" wx:if="{{showUserDetailModal}}">
      <view class="user-detail-content">
        <view class="user-detail-close" bindtap="closeUserDetailModal">Ã—</view>
        <!-- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ -->
        <view class="user-detail-header">
          <image class="user-detail-avatar" src="{{selectedUserDetail.avatarUrl}}" mode="aspectFill"></image>
          <view class="user-detail-info">
            <view class="user-detail-name">{{selectedUserDetail.name}}</view>
            <view class="user-detail-subtitle">UnionLink æ•°å­—èº«ä»½</view>
            <view class="user-detail-stats">{{selectedUserDetail.totalTags}}ä¸ªæ ‡ç­¾ Â· é˜ˆå€¼{{selectedUserDetail.threshold}}</view>
          </view>
        </view>
        <!-- æ ‡ç­¾ä¿¡æ¯ -->
        <view class="user-detail-tags">
          <!-- ä¸“ä¸šé¢†åŸŸæ ‡ç­¾ -->
          <view class="tag-section" wx:if="{{selectedUserDetail.professionalTags.length > 0}}">
            <view class="tag-section-title">ä¸“ä¸šé¢†åŸŸ</view>
            <view class="tag-list">
              <view class="tag-item" wx:for="{{selectedUserDetail.professionalTags}}" wx:key="*this">{{item}}</view>
            </view>
          </view>
          <!-- å…´è¶£çˆ±å¥½æ ‡ç­¾ -->
          <view class="tag-section" wx:if="{{selectedUserDetail.interestTags.length > 0}}">
            <view class="tag-section-title">å…´è¶£çˆ±å¥½</view>
            <view class="tag-list">
              <view class="tag-item" wx:for="{{selectedUserDetail.interestTags}}" wx:key="*this">{{item}}</view>
            </view>
          </view>
          <!-- æ€§æ ¼æ ‡ç­¾ -->
          <view class="tag-section" wx:if="{{selectedUserDetail.personalityTags.length > 0}}">
            <view class="tag-section-title">æ€§æ ¼ç‰¹å¾</view>
            <view class="tag-list">
              <view class="tag-item" wx:for="{{selectedUserDetail.personalityTags}}" wx:key="*this">{{item}}</view>
            </view>
          </view>
          <!-- å½©è›‹æ ‡ç­¾ -->
          <view class="tag-section" wx:if="{{selectedUserDetail.quirkyTags.length > 0}}">
            <view class="tag-section-title">ä¸ªæ€§å½©è›‹</view>
            <view class="tag-list">
              <view class="tag-item" wx:for="{{selectedUserDetail.quirkyTags}}" wx:key="*this">{{item}}</view>
            </view>
          </view>
        </view>
        <!-- è”ç³»ä¿¡æ¯ -->
        <view class="user-detail-contact" wx:if="{{selectedUserDetail.contactInfo}}">
          <view class="contact-title">è”ç³»æ–¹å¼</view>
          <view class="contact-info">{{selectedUserDetail.contactInfo}}</view>
        </view>
        <!-- ä¸ªæ€§æ ‡ç­¾ -->
        <view class="user-detail-personal" wx:if="{{selectedUserDetail.personalTagsText}}">
          <view class="personal-title">ä¸ªæ€§æ ‡ç­¾</view>
          <view class="personal-text">{{selectedUserDetail.personalTagsText}}</view>
        </view>
        <!-- å¾®ä¿¡äºŒç»´ç  -->
        <view class="user-detail-qrcode" wx:if="{{selectedUserDetail.qrCodeUrl}}">
          <view class="qrcode-title">å¾®ä¿¡äºŒç»´ç </view>
          <view class="qrcode-container">
            <image class="qrcode-image" 
                   src="{{selectedUserDetail.qrCodeUrl}}" 
                   mode="aspectFit" 
                   binderror="onQRCodeError"
                   bindlongpress="onQRCodeLongPress"
                   show-menu-by-longpress="true"></image>
          </view>
          <view class="qrcode-hint">é•¿æŒ‰äºŒç»´ç å¯ç›´æ¥æ·»åŠ å¥½å‹</view>
        </view>
      </view>
    </view>
  </view>
</view> 