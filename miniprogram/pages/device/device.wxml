<!--miniprogram/pages/device/device.wxml-->
<view class="container">
  <view class="card-container">
    <!-- æ¶ˆæ¯åŒºåŸŸ -->
    <view class="message-panel">
      <view class="panel-header">
        <text class="panel-title">æ¥æ”¶æ¶ˆæ¯</text>
      </view>
      <scroll-view class="message-content" scroll-y="true" scroll-with-animation="true" scroll-into-view="msg{{receivedMessages.length-1}}">
        <block wx:if="{{receivedMessages.length > 0}}">
          <view wx:for="{{receivedMessages}}" wx:key="time" class="message-item" id="msg{{index}}">
            <view class="message-time">{{item.time}}</view>
            <view class="message-bubble">{{item.content}}</view>
          </view>
        </block>
        <view wx:else class="empty-placeholder">
          <text class="empty-icon">ğŸ“©</text>
          <text>ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...</text>
        </view>
      </scroll-view>
    </view>

    <!-- URLæå–åŒºåŸŸ -->
    <view class="url-panel" wx:if="{{extractedUrl}}">
      <view class="panel-header">
        <text class="panel-title">æå–çš„URL</text>
      </view>
      <view class="url-content">
        <text class="url-text">{{extractedUrl}}</text>
      </view>
    </view>

    <!-- è¿æ¥çŠ¶æ€åŒºåŸŸ -->
    <view class="status-panel">
      <view class="status-dot {{isConnected ? 'connected' : 'disconnected'}}"></view>
      <view class="status-text">{{isConnected ? 'å·²è¿æ¥åˆ°ESP32_NFC_BLE' : 'æœªè¿æ¥åˆ°è®¾å¤‡'}}</view>
      <button class="action-button {{isConnected ? 'reset' : 'connect'}}" bindtap="{{isConnected ? 'resetConnection' : 'startBluetoothConnection'}}">
        {{isConnected ? 'é‡ç½®è¿æ¥' : 'è¿æ¥è®¾å¤‡'}}
      </button>
    </view>

    <!-- æ—¥å¿—åŒºåŸŸ -->
    <view class="log-panel">
      <view class="panel-header">
        <text class="panel-title">è¿æ¥æ—¥å¿—</text>
        <button class="clear-button" bindtap="clearLogs">æ¸…ç©º</button>
      </view>
      <scroll-view class="log-content" scroll-y="true" scroll-with-animation="true" scroll-into-view="log{{connectionLogs.length-1}}">
        <block wx:if="{{connectionLogs.length > 0}}">
          <view wx:for="{{connectionLogs}}" wx:key="*this" class="log-item" id="log{{index}}">
            {{item}}
          </view>
        </block>
        <view wx:else class="empty-placeholder">
          <text>æš‚æ— æ—¥å¿—è®°å½•</text>
        </view>
      </scroll-view>
    </view>
  </view>
</view>